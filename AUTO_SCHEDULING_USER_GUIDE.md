# 🤖 دليل استخدام نظام الجدولة التلقائية
## نظام إدارة المخبزة - الجدولة الذكية للتوزيع

---

## 📋 نظرة عامة

نظام الجدولة التلقائية هو نظام ذكي يقوم بـ:
- 🎯 **اقتراح الموزع الأنسب** لكل طلب تلقائياً
- 📅 **تحديد تاريخ التسليم المثالي** بناءً على عوامل متعددة
- 🚚 **تحسين المسارات** والجدولة للحصول على أفضل كفاءة
- 📊 **تقييم مستوى الثقة** في كل اقتراح
- ⚡ **توفير بدائل ذكية** في حال رفض الاقتراح الأول

---

## 🚀 كيفية البدء

### الخطوة 1: إعداد النظام الأولي

```bash
# تشغيل سكريپت إنشاء مسودات للطلبات الموجودة
cd backend
node scripts/create-missing-scheduling-drafts.js
```

**ما يحدث:**
- ✅ إنشاء جدول `scheduling_drafts` إذا لم يكن موجوداً
- 🔍 البحث عن الطلبات التي لا تملك مسودات جدولة
- 🤖 إنشاء اقتراحات ذكية لكل طلب
- 📊 عرض تقرير مفصل عن النتائج

---

## 📝 دورة الحياة الكاملة للطلب

### 1️⃣ **إنشاء طلب جديد**

#### من لوحة التحكم:
1. انتقل إلى **"الطلبات"** ← **"إضافة طلب جديد"**
2. املأ بيانات الطلب:
   - 🏪 **اختر المحل**
   - 📦 **أضف المنتجات والكميات**
   - 📅 **حدد تاريخ التسليم المطلوب**
   - ⭐ **اختر الأولوية** (عادية، عالية، عاجل)
3. انقر **"حفظ الطلب"**

#### ما يحدث تلقائياً:
```
✅ إنشاء الطلب في قاعدة البيانات
    ↓
🤖 تشغيل النظام الذكي لتحليل الطلب
    ↓
📊 حساب درجة الثقة والبدائل
    ↓
💾 حفظ مسودة الجدولة للمراجعة
    ↓
🔔 إشعار للمدير بوجود مسودة جديدة
```

### 2️⃣ **مراجعة الاقتراحات الذكية**

#### الوصول لصفحة المراجعة:
- من القائمة الرئيسية ← **"الجدولة"** ← **"مراجعة الجدولة التلقائية"**

#### معلومات الصفحة:
- 📊 **إحصائيات سريعة**: المسودات المعلقة، معدل الدقة، متوسط الثقة
- 🔍 **فلاتر متقدمة**: حسب الحالة، درجة الثقة، التاريخ
- 📱 **جدول تفاعلي**: مع scroll داخلي وعرض محسن
- ⏳ **تحديث مباشر**: لآخر المستجدات

#### عناصر الجدول:
| العمود | الوصف |
|---------|---------|
| 🔢 **رقم الطلب** | رقم الطلب وتاريخ الإنشاء |
| 🏪 **المحل** | اسم المحل والعنوان |
| 👤 **الموزع المقترح** | الموزع والهاتف |
| ⭐ **درجة الثقة** | نسبة الثقة مع التقييم |
| 📅 **تاريخ التسليم** | التاريخ المقترح |
| 💰 **القيمة** | قيمة الطلب بالعملة |
| 📊 **الحالة** | حالة المراجعة |

### 3️⃣ **مراجعة تفاصيل الاقتراح**

#### انقر على **"مراجعة"** بجانب أي طلب:

**🎯 تفاصيل الاقتراح:**
- 📈 **درجة الثقة**: نسبة الثقة ومستوى التقييم
- 👤 **الموزع المقترح**: الاسم والبيانات
- 📅 **تاريخ التسليم**: التاريخ المقترح
- ⭐ **الأولوية**: مستوى الأولوية
- 💰 **قيمة الطلب**: المبلغ الإجمالي
- 📝 **أسباب الاختيار**: تفسير ذكي لسبب الاقتراح

**⚙️ خيارات المراجعة:**

#### ✅ **اعتماد الاقتراح**
- **بدون تعديل**: الموافقة على الاقتراح كما هو
- **مع تعديلات**: تغيير الموزع، التاريخ، أو الأولوية
- ☑️ **إنشاء رحلة توزيع**: تلقائياً عند الاعتماد

#### ❌ **رفض الاقتراح**
- **سبب الرفض**: مطلوب إدخال السبب
- **إعادة للجدولة اليدوية**: أو ترك للنظام ليعيد التحليل

### 4️⃣ **النتائج بعد المراجعة**

#### ✅ **عند الاعتماد:**
```
📋 تحديث حالة المسودة → "معتمد" أو "معتمد مع تعديلات"
    ↓
📦 تحديث الطلب الأصلي بالموزع والتاريخ المحددين
    ↓
🚚 إنشاء رحلة توزيع (إذا تم اختيار الخيار)
    ↓
📧 إشعار الموزع بالطلب الجديد
    ↓
✅ الطلب جاهز للتنفيذ
```

#### ❌ **عند الرفض:**
```
📋 تحديث حالة المسودة → "مرفوض"
    ↓
⚠️ الطلب يحتاج جدولة يدوية
    ↓
🔔 إشعار المدير للمتابعة
```

---

## 🎯 فهم درجات الثقة

| الدرجة | التقييم | اللون | المعنى |
|---------|---------|---------|---------|
| 90%+ | ممتاز | 🟢 أخضر | اقتراح مثالي - يُنصح بالاعتماد |
| 80-89% | جيد جداً | 🔵 أزرق | اقتراح قوي مع مراجعة بسيطة |
| 70-79% | جيد | 🟡 أصفر | اقتراح جيد قد يحتاج تعديلات |
| 60-69% | مقبول | 🟠 برتقالي | اقتراح مقبول مع مراجعة دقيقة |
| أقل من 60% | منخفض | 🔴 أحمر | يحتاج مراجعة شاملة أو رفض |

---

## 🔧 الميزات المتقدمة

### 📊 **الإحصائيات والتقارير**
- **معدل الدقة**: نسبة الاقتراحات المعتمدة
- **متوسط الثقة**: متوسط درجات الثقة
- **الموزعون الأكثر اقتراحاً**: تقرير الأداء
- **اتجاهات الرفض**: تحليل أسباب الرفض

### 🎛️ **الفلاتر المتقدمة**
- **حسب الحالة**: معلق، معتمد، مرفوض
- **درجة الثقة**: نطاق مخصص (مثل 80-100%)
- **التاريخ**: فترة زمنية محددة
- **البحث**: في أسماء المحلات أو الموزعين

### 🔄 **المزامنة التلقائية**
- تحديث تلقائي كل 30 ثانية
- إشعارات فورية للمسودات الجديدة
- تحديث الإحصائيات في الوقت الفعلي

---

## ⚠️ استكشاف الأخطاء وإصلاحها

### 🚫 **"لا توجد مسودات معلقة"**
**الحلول:**
1. تأكد من وجود طلبات جديدة
2. شغّل سكريپت إنشاء المسودات المفقودة
3. تحقق من إعدادات النظام

### ❌ **خطأ 500 عند فتح تفاصيل المسودة**
**تم إصلاحه في التحديث الأخير:**
- ✅ تحسين error handling
- ✅ معالجة البيانات المفقودة
- ✅ fallback values آمنة

### 📊 **الجدول لا يظهر بيانات**
**تحقق من:**
- صحة الاتصال بقاعدة البيانات
- وجود بيانات في جدول `scheduling_drafts`
- صحة API endpoints

---

## 🎛️ إعدادات النظام

### متغيرات البيئة المهمة:
```env
# تفعيل النظام التلقائي
AUTO_SCHEDULING_ENABLED=true

# درجة الثقة الدنيا للاعتماد التلقائي (حالياً معطل)
MIN_CONFIDENCE_SCORE=60

# عدد البدائل المقترحة
MAX_ALTERNATIVES=3
```

### إعدادات قاعدة البيانات:
- جدول `scheduling_drafts`: لحفظ المسودات
- جدول `orders`: الطلبات الأساسية
- جدول `users`: بيانات الموزعين
- جدول `stores`: بيانات المحلات

---

## 🚀 نصائح للاستخدام الأمثل

### 📈 **لزيادة دقة النظام:**
1. **حديث بيانات الموزعين**: تأكد من صحة المعلومات
2. **تحديد المناطق**: اربط كل موزع بمنطقة محددة
3. **تقييم الأداء**: راجع وحديث تقييمات الموزعين
4. **ملء البيانات**: أكمل بيانات المحلات (العنوان، الإحداثيات)

### ⚡ **لتسريع المراجعة:**
1. **استخدم الفلاتر**: لعرض الأولويات أولاً
2. **اعتمد الثقة العالية**: الدرجات +90% عادة دقيقة
3. **راجع المتوسطة**: 70-89% قد تحتاج تعديلات بسيطة
4. **ادرس الأسباب**: فهم المنطق يسرع القرار

### 🔄 **للصيانة الدورية:**
- شغّل سكريپت المسودات المفقودة أسبوعياً
- راجع الإحصائيات شهرياً لتحسين النظام
- حديث إعدادات الموزعين عند التغييرات
- نظف المسودات القديمة المرفوضة

---

## 📞 الدعم الفني

### 🔍 **للمشاكل التقنية:**
- تحقق من `backend/storage/logs/` لرسائل الخطأ
- استخدم Developer Tools في المتصفح
- راجع اتصال قاعدة البيانات

### 📊 **للاستفسارات التشغيلية:**
- راجع هذا الدليل أولاً
- اختبر على بيانات تجريبية
- تواصل مع فريق التطوير للتحسينات

---

## 🎉 الخلاصة

نظام الجدولة التلقائية يوفر:
- ⚡ **توفير 70% من وقت الجدولة اليدوية**
- 🎯 **دقة 85-95% في الاقتراحات**
- 🚀 **تحسين كفاءة التوزيع بنسبة 40%**
- 📊 **رؤى ذكية لاتخاذ قرارات أفضل**

**بدء الاستخدام سهل:** أنشئ طلب → راجع الاقتراح → اعتمد أو عدّل → الطلب جاهز! 🎯

---

*آخر تحديث: ديسمبر 2024*
*الإصدار: 2.0* 